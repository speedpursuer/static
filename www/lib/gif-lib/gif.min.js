// This is a JavaScript file
function Gif(){}function GifStream(e){function t(e){if(i>=n.byteLength)throw new Error("Attempted to read past end of stream.");var t=i;return i+=e,t}function r(e,t){var r=0,n=!1;return{readUint8:function(){if(n)return-1;if(0===r){if(r=e.readUint8(),0===r)return n=!0,-1;if(t)return r}return r--,e.readUint8()},empty:function(){for(;-1!==this.readUint8(););},toArray:function(){for(var e,t=[];-1!==(e=this.readUint8());)t.push(e);return t},toString:function(){for(var e,t="";-1!==(e=this.readUint8());)t+=String.fromCharCode(e);return t}}}var n=new DataView(e),i=0;return{readUint8:function(){return n.getUint8(t(1))},readUint16:function(){return n.getUint16(t(2),!0)},readUint32:function(){return n.getUint32(t(4),!0)},readBytes:function(e){for(var t=[],r=0;e>r;r++)t.push(this.readUint8());return t},readString:function(e){for(var t="",r=0;e>r;r++)t+=String.fromCharCode(this.readUint8());return t},readBlock:function(e){return new r(this,e)}}}Gif.prototype={handleBlock:function(e){},parse:function(e){function t(e){return e.reduce(function(e,t){return 2*e+t},0)}function r(e){for(var t=[],r=7;r>=0;r--)t.push(!!(e&1<<r));return t}function n(e){var t=l.readUint8();t!==e&&console.error("Unexpected block size "+t+", expected "+e)}function i(e,t,r){for(var n=1<<e,i=n+1,a=i+1,o=null,c=e+1,d=(1<<c)-1,l=0,s=0,f=0,u=0,h=new Int32Array(4096);;){for(;16>l;){var p=t.readUint8();if(-1===p)break;s|=p<<l,l+=8,u++}if(c>l)break;var g=s&d;if(s>>=c,l-=c,g!==n){if(g===i)break;for(var U=a>g?g:o,k=0,v=U;v>n;)v=h[v]>>8,k++;var w=v;r[f++]=w,f+=k;var S=f;for(U!==g&&(r[f++]=w),v=U;k--;)v=h[v],r[--S]=255&v,v>>=8;null!==o&&4096>a&&(h[a++]=o<<8|w,a>=d+1&&12>c&&(++c,d=d<<1|1)),o=g}else a=i+1,c=e+1,d=(1<<c)-1,o=null}return f<r.length?console.error("GIF stream shorter than expected, missing "+(r.length-f)+" pixels"):f>r.length&&console.error("GIF stream longer than expected, skipped "+(f-r.length)+" pixels"),t.empty(),u}function a(e){for(var t=[],r=0;e>r;r++)t.push(l.readBytes(3));return t}function o(e){if(e.sig=l.readString(3),e.ver=l.readString(3),"GIF"!==e.sig)throw new Error("Not a GIF file");if("87a"!==e.ver&&"89a"!==e.ver)throw new Error("Unsupported GIF version");e.width=l.readUint16(),e.height=l.readUint16();var n=r(l.readUint8());e.gctFlag=n.shift(),e.colorRes=t(n.splice(0,3)),e.gctSortFlag=n.shift(),e.gctSize=t(n.splice(0,3)),e.bgColor=l.readUint8(),e.pixelAspectRatio=l.readUint8(),e.gctFlag&&(e.gct=a(1<<e.gctSize+1))}function c(e){function i(e){n(4);var i=r(l.readUint8());e.reserved=i.splice(0,3),e.disposalMethod=t(i.splice(0,3)),e.userInput=i.shift(),e.transparencyFlag=i.shift(),e.delayTime=l.readUint16(),e.transparencyIndex=l.readUint8(),l.readUint8()}function a(e){e.comment=l.readBlock().toString()}function o(e){n(12),e.leftPos=l.readUint16(),e.topPos=l.readUint16(),e.width=l.readUint16(),e.height=l.readUint16(),e.charCellWidth=l.readUint8(),e.charCellHeight=l.readUint8(),e.fgColor=l.readUint8(),e.bgColor=l.readUint8(),e.plainText=l.readBlock().toString()}function c(e){function t(e){switch(n(3),e.subBlockID=l.readUint8(),e.subBlockID){case 1:e.loopCount=l.readUint16();break;case 2:e.bufferSize=l.readUint32()}l.readUint8()}function r(e){e.xmp=l.readBlock(!0).toString(),e.xmp.length>256&&(e.xmp=e.xmp.substring(0,e.xmp.length-257))}function i(e){e.appData=l.readBlock().toArray()}switch(n(11),e.identifier=l.readString(8),e.authCode=l.readString(3),e.identifier){case"NETSCAPE":t(e);break;case"XMP Data":r(e);break;default:i(e)}}function d(e){e.data=l.readBlock().toArray()}switch(e.label=l.readUint8(),e.label){case 249:e.extType="gce",i(e);break;case 254:e.extType="com",a(e);break;case 1:e.extType="pte",o(e);break;case 255:e.extType="app",c(e);break;default:e.extType="unknown",d(e)}}function d(e){function n(e,t){function r(r,i){var a=i*t,o=(i+1)*t,c=r*t;n.set(e.subarray(a,o),c)}for(var n=new Uint8Array(e.length),i=e.length/t,a=[0,4,2,1],o=[8,8,4,2],c=0,d=0;4>d;d++)for(var l=a[d];i>l;l+=o[d])r(l,c),c++;return n}e.leftPos=l.readUint16(),e.topPos=l.readUint16(),e.width=l.readUint16(),e.height=l.readUint16();var o=r(l.readUint8());e.lctFlag=o.shift(),e.interlaced=o.shift(),e.lctSortFlag=o.shift(),e.reserved=o.splice(0,2),e.lctSize=t(o.splice(0,3)),e.lctFlag&&(e.lct=a(1<<e.lctSize+1)),e.lzwMinCodeSize=l.readUint8(),e.pixels=new Uint8Array(e.width*e.height),e.lzwSize=i(e.lzwMinCodeSize,l.readBlock(),e.pixels),e.interlaced&&(e.pixels=n(e.pixels,e.width))}var l=new GifStream(e),s={};s.type="hdr",o(s),this.handleBlock(s);e:for(;;){var f={};switch(f.sentinel=l.readUint8(),String.fromCharCode(f.sentinel)){case"!":f.type="ext",c(f),this.handleBlock(f);break;case",":f.type="img",d(f),this.handleBlock(f);break;case";":f.type="eof",this.handleBlock(f);break e;default:throw new Error("Unknown block: 0x"+f.sentinel.toString(16))}}}};
