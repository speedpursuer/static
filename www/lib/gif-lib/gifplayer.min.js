"use strict";function GifPlayer(t){function e(){if(d){var e=f;p.pause();var i=document.getElementById("gameArea"),s=g/m,n=window.innerWidth,r=window.innerHeight,o=n/r;o>s?(n=r*s,i.style.height=r+"px",i.style.width=n+"px"):(r=n/s,i.style.width=n+"px",i.style.height=r+"px"),i.style.marginTop=-r/2+"px",i.style.marginLeft=-n/2+"px",t.width=n,t.height=r,a++,p.setFrameIndex(h),e&&p.play()}}function i(t){var e=s.isRenderRaw(),i=p.getFrame(t);if(!i)throw new Error("Invalid frame index: "+t);!e&&o&&o.repair(r),0===t&&p.clear(),e&&(r.save(),r.fillStyle="rgba(0, 0, 0, 0.1)",r.fillRect(i.left,i.top,i.width,i.height),r.restore()),i.blit(r),o=i}var s,n=null,r=t.getContext("2d"),h=0,a=1,o=null,c=0,l=null,f=!1,d=!1,u=!1,g=0,m=0;r.clearRect=function(t,e,i,r){Object.getPrototypeOf(this).clearRect.call(this,t,e,i,r);var h=n.hdr;!s.isRenderRaw()&&s.isRenderBackground()&&h.gctFlag&&(this.save(),this.fillStyle="rgb("+h.gct[h.bgColor].join()+")",this.fillRect(t,e,i,r),this.restore())},function(){window.addEventListener("resize",e,!1),window.addEventListener("orientationchange",e,!1)}();var p={events:new Events,setup:function(t){n=t,n.events.on("load",function(){g=n.hdr.width,m=n.hdr.height,d=!0,e(),this.setFirst(),this.events.emit("ready",n)}.bind(this)),n.events.on("error",function(t){this.events.emit("error",t)}.bind(this))},load:function(t){n=new GifFile,n.byteLength=t.byteLength,n.events.on("load",function(){g=n.hdr.width,m=n.hdr.height,e(),d=!0,this.setFirst(),this.events.emit("ready",n)}.bind(this)),n.events.on("error",function(t){this.events.emit("error",t)}.bind(this)),n.load(t)},play:function(){function t(t){return"87a"===n.hdr.ver&&-1===t?20:-1!==n.loopCount&&2>t?10:t}function e(){if(r.setNext(),r.isLastFrame()){if(c++,-1===n.loopCount)return r.pause(),!1;if(n.loopCount>0&&c>=n.loopCount)return r.pause(),!1}return!0}function i(){e()&&s()}function s(){var s=0;do{var n=r.getFrame(),h=n.gce;if(s=h?h.delayTime:-1,u&&r.events.emit("userInputEnd"),u=h?h.userInput:!1,u&&(r.events.emit("userInputStart",s),0===s))return;if(s=t(s),s>0)l=setTimeout(i,10*s);else if(!e())return}while(0>=s)}if(!(this.getFrameCount()<=1||f)){var r=this;c=0;for(var h=-1,a=this.getFrameCount(),o=0;a>o;o++){var d=this.getFrame(o),g=d.gce,m=g?g.delayTime:-1,p=g?g.userInput:!1;if(p){h=-2;break}if(0===o)h=m;else if(m!==h){h=-2;break}}if(-2!==h&&(h=t(h),0===h))return void this.setLast();f=!0,s(),f&&this.events.emit("play")}},pause:function(){f&&(l&&(clearTimeout(l),l=null),u&&(this.events.emit("userInputEnd"),u=!1),f=!1,this.events.emit("pause"))},stop:function(){f&&(this.pause(),h=0)},toggle:function(){this.isPlaying()?this.pause():this.play()},isPlaying:function(){return f},isReady:function(){return d},setNext:function(){this.setFrameIndex(h+1)},setPrevious:function(){this.setFrameIndex(h-1)},setFirst:function(){this.setFrameIndex(0)},setLast:function(){this.setFrameIndex(this.getFrameCount()-1)},isLastFrame:function(){return this.getFrameIndex()===this.getFrameCount()-1},setFrameIndex:function(t){if(d){var e=this.getFrameCount();if(0!==e){for(;0>t;)t+=e;for(;t>=e;)t-=e;if(h=t,h!==a){this.events.emit("update",h,a);var n,r;s.isRenderRaw()?(this.clear(),n=r=h):a>h?(n=0,r=h):(n=a+1,r=h);for(var o=n;r>=o;o++)i(o);a=h}}}},getFrameIndex:function(){return h},getFrameCount:function(){return n.frames.length},getFrame:function(t){return 1===arguments.length?n.frames[t]:n.frames[h]},getOptions:function(){return s},clear:function(){r.clearRect(0,0,t.width,t.height),o=null},destroy:function(){this.stop(),n.destroy(),t.width=0,t.height=0,d=!1,this.events.emit("destroy"),this.events.off(),h=a=0},destroyWithGIF:function(){this.stop(),t.width=0,t.height=0,d=!1,this.events.emit("destroy"),this.events.off(),h=a=0}};return s=new GifPlayerOptions(p),p}function GifPlayerOptions(t){function e(){var e=t.getFrameIndex();0===e?(t.setNext(),t.setPrevious()):(t.setFrameIndex(0),t.setFrameIndex(e))}var i=!1,s=!1;this.setRenderRaw=function(t){i!==t&&(i=t,e())},this.isRenderRaw=function(){return i},this.setRenderBackground=function(t){s!==t&&(s=t,e())},this.isRenderBackground=function(){return s}}function GifFile(){this.hdr=null,this.loopCount=-1,this.comments=[],this.frames=[],this.worker,this.loaded=!1}function GifFrame(t,e,i){this.hdr=t,this.gce=e,this.canvas=null,this.prevImageData=null,this.width=i.width,this.height=i.height,this.top=i.topPos,this.left=i.leftPos,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.trans=-1,this.gce&&this.gce.transparencyFlag&&(this.trans=this.gce.transparencyIndex)}function GifImageFrame(t,e,i){GifFrame.call(this,t,e,i),this.img=i;var s,n=this.ctx.getImageData(0,0,this.width,this.height);if(this.img&&this.img.lctFlag)s=this.img.lct;else{if(!this.hdr.gctFlag)throw new GifError("No color table defined");s=this.hdr.gct}for(var r,h,a=this.img.pixels,o=0;o<a.length;o++)r=a[o],0>r||r>=s.length||(h=s[r],n.data[4*o+0]=h[0],n.data[4*o+1]=h[1],n.data[4*o+2]=h[2],r===this.trans?n.data[4*o+3]=0:n.data[4*o+3]=255);this.ctx.putImageData(n,0,0),this.img.pixels=a=null}function GifTextFrame(t,e,i){GifFrame.call(this,t,e,i),this.pte=i;var s=this.hdr.gct;if(!s)throw new GifError("No color table defined");if(this.pte.bgColor!==this.trans){var n=s[this.pte.bgColor];this.ctx.fillStyle="rgb("+n.join()+")",this.ctx.fillRect(0,0,this.width,this.height)}if(this.pte.fgColor!==this.trans){var r=s[this.pte.fgColor],h=this.pte.charCellWidth,a=this.pte.charCellHeight,o=(.8*a).toFixed(2)+"pt";this.ctx.font=o+' "Lucida Console", Monaco, monospace',this.ctx.textBaseline="middle",this.ctx.fillStyle="rgb("+r.join()+")";for(var c=0,l=Math.floor(this.height/a)*a,f=a/2,d=0,u=Math.floor(this.width/h)*h,g=this.pte.plainText,m=0;m<g.length;m++){var p=g.charCodeAt(m);if((32>p||p>127)&&(p=32),this.ctx.fillText(String.fromCharCode(p),d,c+f,h),d+=h,d>=u&&(d=0,c+=a,c>=l))break}}}GifFile.prototype={events:new Events,load:function(t){var e,i=function(t){switch(t.type){case"hdr":this.hdr=t;break;case"img":this.frames.push(new GifImageFrame(this.hdr,e,t)),e=null;break;case"ext":switch(t.extType){case"gce":e=t;break;case"com":var i=t.comment.replace(/\r\n?/g,"\n");this.comments.push(i);break;case"pte":this.frames.push(new GifTextFrame(this.hdr,e,t)),e=null;break;case"app":switch(t.identifier){case"NETSCAPE":this.loopCount=t.loopCount;break;case"XMP Data":this.xmp=t.xmp}}break;case"eof":this.events.emit("load"),this.loaded=!0}}.bind(this);this.byteLength=t.byteLength,this.initialize();var s=function(t){this.events.emit("error",t)}.bind(this),n=!!window.Worker;if(window.chrome&&"file:"===window.location.protocol&&(n=!1),n)this.worker=new Worker("components/gif-lib/gifworker.js"),this.worker.addEventListener("message",function(t){i(t.data)},!1),this.worker.addEventListener("error",s,!1),this.worker.postMessage(t);else try{var r=new Gif;r.handleBlock=i,r.parse(t)}catch(h){s(h)}},destroy:function(){this.worker&&(this.worker.terminate(),this.worker=void 0),this.hdr=null,this.loopCount=-1,this.comments=[],this.frames=[],this.events.emit("destroy"),this.events.off(),this.loaded=!1},destoryEvent:function(){this.events.off()},completed:function(){return this.loaded},initialize:function(){this.frames.length>0&&this.destroy()}},GifFrame.prototype={blit:function(t){this.gce&&3===this.gce.disposalMethod&&(this.prevImageData=t.getImageData(this.left,this.top,this.width,this.height)),t.drawImage(this.canvas,this.left,this.top,t.canvas.width,t.canvas.height)},repair:function(t){if(this.gce)switch(this.gce.disposalMethod){case 2:t.clearRect(this.left,this.top,this.width,this.height);break;case 3:this.prevImageData&&t.putImageData(this.prevImageData,this.left,this.top)}},resetSize:function(t,e){this.width=t,this.height=e}},GifImageFrame.prototype=Object.create(GifFrame.prototype),GifTextFrame.prototype=Object.create(GifFrame.prototype);