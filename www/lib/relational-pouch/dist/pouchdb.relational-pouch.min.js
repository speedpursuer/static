!function e(t,n,r){function o(u,s){if(!n[u]){if(!t[u]){var c="function"==typeof require&&require;if(!s&&c)return c(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var a=n[u]={exports:{}};t[u][0].call(a.exports,function(e){var n=t[u][1][e];return o(n?n:e)},a,a.exports,e,t,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,t,n){"use strict";function r(){this.store={}}function o(){this.store=new r}n.Map=r,n.Set=o,r.prototype.mangle=function(e){if("string"!=typeof e)throw new TypeError("key must be a string but Got "+e);return"$"+e},r.prototype.unmangle=function(e){return e.substring(1)},r.prototype.get=function(e){var t=this.mangle(e);return t in this.store?this.store[t]:void 0},r.prototype.set=function(e,t){var n=this.mangle(e);return this.store[n]=t,!0},r.prototype.has=function(e){var t=this.mangle(e);return t in this.store},r.prototype["delete"]=function(e){var t=this.mangle(e);return t in this.store?(delete this.store[t],!0):!1},r.prototype.forEach=function(e){var t=this,n=Object.keys(t.store);n.forEach(function(n){var r=t.store[n];n=t.unmangle(n),e(r,n)})},o.prototype.add=function(e){return this.store.set(e,!0)},o.prototype.has=function(e){return this.store.has(e)},o.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],2:[function(e,t,n){"use strict";function r(e){var t=new Error(e);return t.status=400,t}function o(e,t){return e.id<t.id?-1:1}function i(e,t){var n=e.replace("_","")+"_";if("number"==typeof t){for(t=t.toString();t.length<d;)t="0"+t;n+=v+"_"+t}else n+="undefined"==typeof t?h:"object"==typeof t?m:y+"_"+t;return n}function u(e){var t=e.indexOf("_"),n=e.charAt(t+1),r=e.substring(t+3);return n===v?parseInt(r,10):r}var s=e("./../pouch-utils"),c=s.extend,a=s.Promise,f=e("./collections"),l=e("./uuid"),p=e("uniq"),d=16,h="0",v="1",y="2",m="3";n.setSchema=function(e){function t(e,t){t=c(!0,{},t);var n={};t.rev&&(n._rev=t.rev,delete t.rev),t.attachments&&(n._attachments=t.attachments,delete t.attachments);var r=t.id||l();return delete t.id,n._id=i(e.documentType,r),e.relations&&Object.keys(e.relations).forEach(function(n){var r=e.relations[n],o=Object.keys(r)[0];if("belongsTo"===o)t[n]&&"undefined"!=typeof t[n].id&&(t[n]=t[n].id);else if(t[n]){var i=t[n].map(function(e){return e&&"undefined"!=typeof e.id?e.id:e});t[n]=i}else t[n]=[]}),n.data=t,n}function n(e){var t=e.data;return t.id=u(e._id),t.rev=e._rev,e._attachments&&(t.attachments=e._attachments),t}function d(e){if(!O.has(e))throw r("unknown type: "+JSON.stringify(e));return O.get(e)}function h(e,n){var r,o=d(e);return a.resolve().then(function(){return r=t(o,n),_.put(r)}).then(function(e){var t={};return t[o.plural]=[c(!0,n,{id:u(e.id),rev:e.rev})],t})}function v(e,n){var r,o=d(e);return a.resolve().then(function(){return r=t(o,n),r={_id:r._id,_rev:r._rev,_deleted:!0},_.put(r)}).then(function(){return{deleted:!0}})}function y(e,t,n){var r=d(e),o={include_docs:!0};return"undefined"==typeof t||null===t?(o.startkey=i(r.documentType),o.endkey=i(r.documentType,{})):Array.isArray(t)?o.keys=t.map(function(e){return i(r.documentType,e)}):"object"==typeof t?("undefined"==typeof t.startkey||null===t.startkey?o.startkey=i(r.documentType):o.startkey=i(r.documentType,t.startkey),"undefined"==typeof t.endkey||null===t.endkey?o.endkey=i(r.documentType,{}):o.endkey=i(r.documentType,t.endkey),o=m(t,["limit","skip"],o)):o.key=i(r.documentType,t),n.has(e)||n.set(e,new f.Map),_.allDocs(o).then(function(t){return w(t,n,e,r)}).then(function(e){return g(e,n,!0)})}function m(e,t,n){return t.forEach(function(t){"undefined"!=typeof e[t]&&null!==e.skip&&(n[t]=e[t])}),n}function w(e,t,r,o){var i=e.rows.filter(function(e){return e.doc&&(!e.value||!e.value.deleted)}).map(function(e){var i=n(e.doc);t.get(r).set(JSON.stringify(i.id),i);var u=[];return Object.keys(o.relations||{}).forEach(function(e){var n=o.relations[e],r=Object.keys(n)[0],s=n[r];if("string"!=typeof s){var f=s.options;if(f&&f.async)return;s=s.type}if("belongsTo"===r){var l=i[e];"undefined"!=typeof l&&u.push(a.resolve().then(function(){return t.has(s)&&t.get(s).has(JSON.stringify(l))?void 0:{relatedType:s,relatedIds:[l]}}))}else{var p=c(!0,[],i[e]);"undefined"!=typeof p&&p.length&&u.push(a.resolve().then(function(){for(var e=p.length-1;e>=0;e--){var n=p[e];t.has(s)&&t.get(s).has(JSON.stringify(n))&&delete p[e]}return p=p.filter(function(e){return"undefined"!=typeof e}),p.length?{relatedType:s,relatedIds:p}:void 0}))}}),a.all(u)});return a.all(i)}function g(e,t,n){var r={};return e.forEach(function(e){e.forEach(function(e){e&&(r[e.relatedType]=(r[e.relatedType]||[]).concat(e.relatedIds))})}),s.series(Object.keys(r).map(function(e){var n=p(r[e]);return function(){return y(e,n,t)}})).then(function(){var e={};return t.forEach(function(t,r){var i=d(r),u=e[i.plural]=[];t.forEach(function(e){u.push(e)}),n&&u.sort(o)}),e})}function E(e,t,n){var r=new f.Map;r.set(e,new f.Map);var o=d(e),i=m(n,["startkey","endkey","key","keys","limit","skip"],{});return i.include_docs=!0,_.query(t,i).then(function(t){return w(t,r,e,o)}).then(function(e){return g(e,r,!1)})}function b(e,t,n,r,o){var s=i(e,t.id),f=d(e);return a.resolve().then(function(){return _.putAttachment(s,n,t.rev,r,o)}).then(function(e){var n={};return n[f.plural]=[c(!0,t,{id:u(e.id),rev:e.rev})],n})}function j(e,t,n){var r=i(e,t.id),o=d(e);return a.resolve().then(function(){return _.removeAttachment(r,n,t.rev)}).then(function(e){var n={};return n[o.plural]=[c(!0,t,{id:u(e.id),rev:e.rev})],n})}function T(e,t,n,r){return r=r||{},a.resolve().then(function(){return _.getAttachment(i(e,t),n,r)})}function k(e,t){return a.resolve().then(function(){return h(e,t)})}function N(e,t){return a.resolve().then(function(){return y(e,t,new f.Map)})}function I(e,t){return a.resolve().then(function(){return v(e,t)})}function x(e,t,n){return a.resolve().then(function(){return E(e,t,n)})}function A(t){var n=t.indexOf("_"),r=t.substring(0,n),o=u(t),i=O.get(r);if(!i){var s=e.filter(function(e){return e.documentType===r});s.length>0&&(r=s[0].singular)}return{type:r,id:o}}function L(e){var t=e.type,n=O.get(t);return n&&(t=n.documentType),i(t,e.id)}var _=this,O=new f.Map;e.forEach(function(e){O.set(e.singular,e),O.set(e.plural,e)}),e.forEach(function(e){e.documentType=e.documentType||e.singular}),e.forEach(function(e){if(e.relations){if(!Object.keys(e.relations).length)throw new Error("Invalid relations for: "+e);Object.keys(e.relations).forEach(function(t){var n=e.relations[t];if(1!==Object.keys(n).length)throw new Error("Invalid relationship definition for: "+t);var r=Object.keys(n)[0],o=n[r];if("string"!=typeof o&&(o=o.type),!O.get(o))throw new Error("Unknown entity type: "+o);if("belongsTo"!==r&&"hasMany"!==r)throw new Error("Invalid relationship type for "+t+": "+r)})}}),_.rel={save:k,find:N,del:I,getAttachment:T,putAttachment:b,removeAttachment:j,parseDocID:A,makeDocID:L,query:x}},"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(n)},{"./../pouch-utils":22,"./collections":1,"./uuid":3,uniq:21}],3:[function(e,t,n){"use strict";function r(e){return 0|Math.random()*e}function o(e,t){t=t||i.length;var n="",o=-1;if(e){for(;++o<e;)n+=i[r(t)];return n}for(;++o<36;)switch(o){case 8:case 13:case 18:case 23:n+="-";break;case 19:n+=i[3&r(16)|8];break;default:n+=i[r(16)]}return n}var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");t.exports=o},{}],4:[function(e,t,n){function r(){p=!0;for(var e,t,n=d.length;n;){for(t=d,d=[],e=-1;++e<n;)t[e]();n=d.length}p=!1}function o(e){1!==d.push(e)||p||i()}var i,u="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},s=u.MutationObserver||u.WebKitMutationObserver;if(s){var c=0,a=new s(r),f=u.document.createTextNode("");a.observe(f,{characterData:!0}),i=function(){f.data=c=++c%2}}else if(u.setImmediate||"undefined"==typeof u.MessageChannel)i="document"in u&&"onreadystatechange"in u.document.createElement("script")?function(){var e=u.document.createElement("script");e.onreadystatechange=function(){r(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},u.document.documentElement.appendChild(e)}:function(){setTimeout(r,0)};else{var l=new u.MessageChannel;l.port1.onmessage=r,i=function(){l.port2.postMessage(0)}}var p,d=[];t.exports=o},{}],5:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],6:[function(e,t,n){"use strict";function r(){}t.exports=r},{}],7:[function(e,t,n){"use strict";function r(e){function t(e,t){function o(e){a[t]=e,++f===n&!r&&(r=!0,c.resolve(p,a))}u(e).then(o,function(e){r||(r=!0,c.reject(p,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return i(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return u([]);for(var a=new Array(n),f=0,l=-1,p=new o(s);++l<n;)t(e[l],l);return p}var o=e("./promise"),i=e("./reject"),u=e("./resolve"),s=e("./INTERNAL"),c=e("./handlers");t.exports=r},{"./INTERNAL":6,"./handlers":8,"./promise":10,"./reject":13,"./resolve":14}],8:[function(e,t,n){"use strict";function r(e){var t=e&&e.then;return e&&"object"==typeof e&&"function"==typeof t?function(){t.apply(e,arguments)}:void 0}var o=e("./tryCatch"),i=e("./resolveThenable"),u=e("./states");n.resolve=function(e,t){var s=o(r,t);if("error"===s.status)return n.reject(e,s.value);var c=s.value;if(c)i.safely(e,c);else{e.state=u.FULFILLED,e.outcome=t;for(var a=-1,f=e.queue.length;++a<f;)e.queue[a].callFulfilled(t)}return e},n.reject=function(e,t){e.state=u.REJECTED,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e}},{"./resolveThenable":15,"./states":16,"./tryCatch":17}],9:[function(e,t,n){t.exports=n=e("./promise"),n.resolve=e("./resolve"),n.reject=e("./reject"),n.all=e("./all"),n.race=e("./race")},{"./all":7,"./promise":10,"./race":12,"./reject":13,"./resolve":14}],10:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=s.PENDING,this.queue=[],this.outcome=void 0,e!==i&&u.safely(this,e)}var o=e("./unwrap"),i=e("./INTERNAL"),u=e("./resolveThenable"),s=e("./states"),c=e("./queueItem");t.exports=r,r.prototype["catch"]=function(e){return this.then(null,e)},r.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s.FULFILLED||"function"!=typeof t&&this.state===s.REJECTED)return this;var n=new r(i);if(this.state!==s.PENDING){var u=this.state===s.FULFILLED?e:t;o(n,u,this.outcome)}else this.queue.push(new c(n,e,t));return n}},{"./INTERNAL":6,"./queueItem":11,"./resolveThenable":15,"./states":16,"./unwrap":18}],11:[function(e,t,n){"use strict";function r(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}var o=e("./handlers"),i=e("./unwrap");t.exports=r,r.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},r.prototype.otherCallFulfilled=function(e){i(this.promise,this.onFulfilled,e)},r.prototype.callRejected=function(e){o.reject(this.promise,e)},r.prototype.otherCallRejected=function(e){i(this.promise,this.onRejected,e)}},{"./handlers":8,"./unwrap":18}],12:[function(e,t,n){"use strict";function r(e){function t(e){u(e).then(function(e){r||(r=!0,c.resolve(f,e))},function(e){r||(r=!0,c.reject(f,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return i(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return u([]);for(var a=-1,f=new o(s);++a<n;)t(e[a]);return f}var o=e("./promise"),i=e("./reject"),u=e("./resolve"),s=e("./INTERNAL"),c=e("./handlers");t.exports=r},{"./INTERNAL":6,"./handlers":8,"./promise":10,"./reject":13,"./resolve":14}],13:[function(e,t,n){"use strict";function r(e){var t=new o(i);return u.reject(t,e)}var o=e("./promise"),i=e("./INTERNAL"),u=e("./handlers");t.exports=r},{"./INTERNAL":6,"./handlers":8,"./promise":10}],14:[function(e,t,n){"use strict";function r(e){if(e)return e instanceof o?e:u.resolve(new o(i),e);var t=typeof e;switch(t){case"boolean":return s;case"undefined":return a;case"object":return c;case"number":return f;case"string":return l}}var o=e("./promise"),i=e("./INTERNAL"),u=e("./handlers");t.exports=r;var s=u.resolve(new o(i),!1),c=u.resolve(new o(i),null),a=u.resolve(new o(i),void 0),f=u.resolve(new o(i),0),l=u.resolve(new o(i),"")},{"./INTERNAL":6,"./handlers":8,"./promise":10}],15:[function(e,t,n){"use strict";function r(e,t){function n(t){s||(s=!0,o.reject(e,t))}function r(t){s||(s=!0,o.resolve(e,t))}function u(){t(r,n)}var s=!1,c=i(u);"error"===c.status&&n(c.value)}var o=e("./handlers"),i=e("./tryCatch");n.safely=r},{"./handlers":8,"./tryCatch":17}],16:[function(e,t,n){n.REJECTED=["REJECTED"],n.FULFILLED=["FULFILLED"],n.PENDING=["PENDING"]},{}],17:[function(e,t,n){"use strict";function r(e,t){var n={};try{n.value=e(t),n.status="success"}catch(r){n.status="error",n.value=r}return n}t.exports=r},{}],18:[function(e,t,n){"use strict";function r(e,t,n){o(function(){var r;try{r=t(n)}catch(o){return i.reject(e,o)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)})}var o=e("immediate"),i=e("./handlers");t.exports=r},{"./handlers":8,immediate:4}],19:[function(e,t,n){"use strict";function r(e){return null===e?String(e):"object"==typeof e||"function"==typeof e?a[d.call(e)]||"object":typeof e}function o(e){return null!==e&&e===e.window}function i(e){if(!e||"object"!==r(e)||e.nodeType||o(e))return!1;try{if(e.constructor&&!h.call(e,"constructor")&&!h.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var n;for(n in e);return void 0===n||h.call(e,n)}function u(e){return"function"===r(e)}function s(){for(var e=[],t=-1,n=arguments.length,r=new Array(n);++t<n;)r[t]=arguments[t];var o={};e.push({args:r,result:{container:o,key:"key"}});for(var i;i=e.pop();)c(e,i.args,i.result);return o.key}function c(e,t,n){var r,o,s,c,a,f,l,p=t[0]||{},d=1,h=t.length,y=!1,m=/\d+/;for("boolean"==typeof p&&(y=p,p=t[1]||{},d=2),"object"==typeof p||u(p)||(p={}),h===d&&(p=this,--d);h>d;d++)if(null!=(r=t[d])){l=v(r);for(o in r)if(!(o in Object.prototype)){if(l&&!m.test(o))continue;if(s=p[o],c=r[o],p===c)continue;y&&c&&(i(c)||(a=v(c)))?(a?(a=!1,f=s&&v(s)?s:[]):f=s&&i(s)?s:{},e.push({args:[y,f,c],result:{container:p,key:o}})):void 0!==c&&(v(r)&&u(c)||(p[o]=c))}}n.container[n.key]=p}for(var a={},f=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],l=0;l<f.length;l++){var p=f[l];a["[object "+p+"]"]=p.toLowerCase()}var d=a.toString,h=a.hasOwnProperty,v=Array.isArray||function(e){return"array"===r(e)};t.exports=s},{}],20:[function(e,t,n){var r=t.exports={};r.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],21:[function(e,t,n){"use strict";function r(e,t){for(var n=1,r=e.length,o=e[0],i=e[0],u=1;r>u;++u)if(i=o,o=e[u],t(o,i)){if(u===n){n++;continue}e[n++]=o}return e.length=n,e}function o(e){for(var t=1,n=e.length,r=e[0],o=e[0],i=1;n>i;++i,o=r)if(o=r,r=e[i],r!==o){if(i===t){t++;continue}e[t++]=r}return e.length=t,e}function i(e,t,n){return 0===e.length?e:t?(n||e.sort(t),r(e,t)):(n||e.sort(),o(e))}t.exports=i},{}],22:[function(e,t,n){var r,o=e("__browserify_process"),i="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};r="undefined"!=typeof window&&window.PouchDB?window.PouchDB.utils.Promise:"function"==typeof i.Promise?i.Promise:e("lie"),n.once=function(e){var t=!1;return n.getArguments(function(n){if(t)throw console.trace(),new Error("once called  more than once");t=!0,e.apply(this,n)})},n.getArguments=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}},n.toPromise=function(e){return n.getArguments(function(t){var i,u=this,s="function"==typeof t[t.length-1]?t.pop():!1;s&&(i=function(e,t){o.nextTick(function(){s(e,t)})});var c=new r(function(r,o){try{var i=n.once(function(e,t){e?o(e):r(t)});t.push(i),e.apply(u,t)}catch(s){o(s)}});return i&&c.then(function(e){i(null,e)},i),c.cancel=function(){return this},c})},n.series=function(e){var t=n.Promise.resolve(),r=new Array(e.length);return e.forEach(function(n,o){t=t.then(e[o]).then(function(e){r[o]=e})}),t.then(function(){return r})},n.inherits=e("inherits"),n.Promise=r,n.extend=e("pouchdb-extend")},{__browserify_process:20,inherits:5,lie:9,"pouchdb-extend":19}]},{},[2]);
