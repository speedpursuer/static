<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport"content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width"><title></title><link href="lib/ionic/css/ionic.css" rel="stylesheet"><link href="css/app.css" rel="stylesheet"><script src="lib/ionic/js/ionic.bundle.min.js"></script><script src="lib/sha1.js"></script><script src="lib/pouchdb/dist/pouchdb-5.2.1.min.js"></script><script src="lib/pouchdb/dist/pouchdb.load.min.js"></script><script src="lib/angular-pouchdb/angular-pouchdb.js"></script><script src="lib/imgcache.js/js/imgcache.js"></script><script src="lib/angular-imgcache/angular-imgcache.js"></script><script src="lib/other-lib/jquery-2.1.3.min.js"></script><script src="lib/ngCordova/dist/ng-cordova.min.js"></script><script src="cordova.js"></script><script>angular.module("app","ionic app.controllers app.routes app.services app.directives pouchdb ImgCache ngCordova".split(" ")).config(["$ionicConfigProvider","ImgCacheProvider",function(a,b){b.setOptions({usePersistentCache:!0,useDataURI:!0,skipURIencoding:!0});a.views.swipeBackEnabled(!1);a.scrolling.jsScrolling(!1)}]).run(["$ionicPlatform","$cordovaStatusbar","$rootScope",function(a,b,f){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),cordova.plugins.Keyboard.disableScroll(!0));window.StatusBar&&StatusBar.styleDefault()});f.$on("$stateChangeError",function(a,b,f,l,u,r){console.log("stateChangeError");a.preventDefault()})}]);angular.module("app.routes",[]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/root");a.state("root",{url:"/root",controller:"RootCtrl",templateUrl:"templates/root.html"}).state("tabsController",{url:"/tab","abstract":!0,templateUrl:"templates/tabsController.html",resolve:{init:["DBService",function(a){return a.init()}]}}).state("tabsController.stars",{url:"/stars",views:{tab1:{templateUrl:"templates/stars.html",controller:"StarsCtrl"}}}).state("tabsController.moves",{url:"/moves/:playerID, :playerName",resolve:{moves:["$stateParams","DBService",function(a,c){return c.dataFetcher().getMovesByPlayer(a.playerID)}]},views:{tab1:{controller:"MovesCtrl",templateUrl:"templates/moves.html"}}}).state("tabsController.clips",{url:"/clips/:playerID, :moveName, :moveID",resolve:{clips:["$stateParams","DBService",function(a,c){return c.pagination().clips().init(a.playerID,a.moveID)}]},views:{tab1:{controller:"ClipsCtrl",templateUrl:"templates/clips.html"}}}).state("tabsController.players",{url:"/players",views:{tab2:{controller:"PlayersCtrl",templateUrl:"templates/players.html"}}}).state("tabsController.tab2Moves",{url:"/moves2/:playerID, :playerName",resolve:{moves:["$stateParams","DBService",function(a,c){return c.dataFetcher().getMovesByPlayer(a.playerID)}]},views:{tab2:{controller:"Tab2MovesCtrl",templateUrl:"templates/moves.html"}}}).state("tabsController.tab2Clips",{url:"/clips2/:playerID, :moveName, :moveID",resolve:{clips:["$stateParams","DBService",function(a,c){return c.pagination().clips().init(a.playerID,a.moveID)}]},views:{tab2:{controller:"ClipsCtrl",templateUrl:"templates/clips.html"}}}).state("tabsController.news",{url:"/news",views:{tab3:{controller:"NewsCtrl",templateUrl:"templates/news.html"}}}).state("tabsController.plays",{url:"/plays",views:{tab4:{controller:"PlaysCtrl",templateUrl:"templates/plays.html"}}}).state("tabsController.play",{url:"/play/:catID, :catName",resolve:{plays:["$stateParams","DBService",function(a,c){return c.getPlaysByCat(a.catID)}]},views:{tab4:{controller:"PlayCtrl",templateUrl:"templates/play.html"}}}).state("tabsController.skills",{url:"/skills",views:{tab5:{controller:"SkillsCtrl",templateUrl:"templates/skills.html"}}}).state("tabsController.skill",{url:"/skill/:catID, :catName",resolve:{plays:["$stateParams","DBService",function(a,c){return c.getSkillsByCat(a.catID)}]},views:{tab5:{controller:"SkillCtrl",templateUrl:"templates/skill.html"}}})}]);angular.module("app.services",[]).factory("DBService",["$q","$timeout","pouchdb","ErrorService","FileCacheService","NativeService",function(a,b,f,c,k,n){function l(a,d){r().then(function(){a.resolve("data prefetched");d&&d()})["catch"](function(d){z();a.reject("Err in getting init data: "+d)})}function u(a,d){r(!0).then(function(){a.resolve("data prefetched");d&&d()})["catch"](function(d){z();a.reject("Err in getting init data: "+d)})}function r(a){a=[];a.push(w());a.push(x.news().init());a.push(A());a.push(B());return v(a)}function v(g){var d=[];angular.forEach(g,function(a){d.push(a)});return a.all(d)}function z(){c.showAlert("\u542f\u52a8\u9047\u5230\u95ee\u9898","\u8bf7\u60a8\u91cd\u65b0\u4e0b\u8f7d\u5b89\u88c5\u3002",!1)}function F(){return x.news().refresh()}function w(g){var d=a.defer();h.allDocs({include_docs:!0,startkey:"player",endkey:"player\uffff"}).then(function(a){a=a.rows.map(function(a){return a.doc});if(!g)for(i in a)a[i].star&&m.starList.push(a[i]);m.setPlayerList(a);d.resolve("All players retrieved")})["catch"](function(a){d.reject(a)});return d.promise}function A(){return a(function(a,d){C("plays").then(function(d){m.setPlaysList(d.category);a("plays retrieved")})["catch"](function(a){d(a)})})}function B(){return a(function(a,d){C("skills").then(function(d){m.setSkillsList(d.cats);a("skills retrieved")})["catch"](function(a){d(a)})})}function p(a,d){a.push.apply(a,d)}function C(g){return a(function(a,c){h.get(g).then(function(g){a(g)})["catch"](function(a){c(a)})})}function G(){var g=a.defer();h.destroy().then(function(){D();g.resolve("DB recreated")})["catch"](function(){g.reject("DB destroy err")});return g.promise}function D(){h&&(h=null);h=f.create(q.dbName,{auto_compaction:!1})}function H(){var g=a.defer();E()?window.resolveLocalFileSystemURL(cordova.file.applicationDirectory+"/"+q.file,function(a){a.file(function(a){var d=new FileReader;d.onloadend=function(a){g.resolve(h.load(this.result))};d.readAsText(a)})},function(a){console.log("FileSystem Error");console.dir(a);g.reject(a)}):g.resolve(h.load(q.file));return g.promise}function E(){return"undefined"!==typeof cordova||"undefined"!==typeof phonegap}function I(){return h.put({_id:"_local/DBInstalled",status:"completed"})}b={};var q={dbName:dbString?"cliplay_prod":"cliplay_dev_3_29",remoteURL:dbString?dbString.split(",")[0]:"http://admin:12341234@localhost:5984/",file:dbString?dbString.split(",")[1]:"db.txt",dbAdapter:"websql",installFail:!1},h=null;k="undefined"!==typeof device&&-1!==device.model.indexOf("iPad")?!0:!1;var t={postInfo:!1,playInfo:!1,playPost:function(a){var d=[!this.postInfo,JSON.stringify(a)];1<a.image.length&&!this.postInfo&&(this.postInfo=!0,h.get("_local/DBInstalled").then(function(a){a.postInfo=!0;return h.put(a)}));n.play(d)},playPost_:function(a){var d=a.slice();d.unshift(!this.postInfo);1<a.length&&!this.postInfo&&(this.postInfo=!0,h.get("_local/DBInstalled").then(function(a){a.postInfo=!0;return h.put(a)}));n.playAnimation(d)},playPlay:function(a){var d=a.slice();d.unshift(!this.playInfo);1<a.length&&!this.playInfo&&(this.playInfo=!0,h.get("_local/DBInstalled").then(function(a){a.playInfo=!0;return h.put(a)}));n.playPlay(d)},playArticle:function(a){var d=[!this.postInfo,JSON.stringify(a)];1<a.image.length&&!this.postInfo&&(this.postInfo=!0,h.get("_local/DBInstalled").then(function(a){a.postInfo=!0;return h.put(a)}));n.playArticle(d)}};b.playClipsByMove=function(a,d){h.get("post_"+a+"_"+d).then(function(a){!a.image instanceof Array?console.log("Image list not retrieved"):t.playPost(a)})["catch"](function(a){console.log(a)})};b.getGaleryByPlayer=function(a){h.get("galery_"+a).then(function(a){t.playPost(a)})["catch"](function(a){console.log(e)})};b.getSkillsByCat=function(g){var d=a.defer();h.allDocs({include_docs:!0,startkey:"skill_"+g,endkey:"skill_"+g+"\uffff"}).then(function(a){a=a.rows.map(function(a){return a.doc});d.resolve(a)})["catch"](function(a){d.reject(a)});return d.promise};b.getPlaysByCat=function(g){var d=a.defer();h.allDocs({include_docs:!0,startkey:"plays_"+g,endkey:"plays_"+g+"\uffff"}).then(function(a){a=a.rows.map(function(a){return a.doc});d.resolve(a)})["catch"](function(a){d.reject(a)});return d.promise};b.list=function(){return m};b.dataFetcher=function(){return J};b.pagination=function(){return x};b.remoteDB=function(){return K};b.play=function(){return t};var m={favoriteList:[],playerList:[],moveList:[],clipList:[],starList:[],newsList:[],playsList:[],skillsList:[],getPlaysList:function(){return this.playsList},setPlaysList:function(a){this.playsList.length=0;p(this.playsList,a)},getSkillsList:function(){return this.skillsList},setSkillsList:function(a){this.skillsList.length=0;p(this.skillsList,a)},getStarList:function(){return this.starList},setClipList:function(a){p(this.clipList,a)},resetClipList:function(){this.clipList.length=0},getClipList:function(){return this.clipList},setNewsList:function(a){p(this.newsList,a)},addNewsList:function(a){var d=this.newsList;d.unshift.apply(d,a)},resetNewsList:function(){this.newsList.length=0},getNewsList:function(){return this.newsList},setMoveList:function(a){this.moveList.length=0;p(this.moveList,a)},getMoveList:function(){return this.moveList},setPlayerList:function(a){this.playerList.length=0;p(this.playerList,a)},getPlayerList:function(){return this.playerList},setFavoriteList:function(a){p(this.favoriteList,a)},resetFavoriteList:function(){this.favoriteList.length=0},getFavoriteList:function(){return this.favoriteList},addFavoriteToList:function(a,d){for(var c=0;c<this.favoriteList.length;c++)if(this.favoriteList[c]._id==a)return;var y=this;h.get(a).then(function(a){a.thumb=d;a.favorite=!0;y.favoriteList.unshift(a)})},removeFavoriteFromList:function(a){for(var d=0;d<this.favoriteList.length;d++)if(this.favoriteList[d]._id==a){this.favoriteList.splice(d,1);break}},getAllPlayers:function(){return w()}},J={getMoves:function(){var g=a.defer();h.allDocs({include_docs:!0,startkey:"move",endkey:"move\uffff"}).then(function(a){a=a.rows.map(function(a){return a.doc});m.setMoveList(a);g.resolve("All moves retrieved")})["catch"](function(a){g.reject(a)});return g.promise},getMovesByPlayer:function(g){var d=a.defer(),c=[];h.get(g).then(function(a){c=a.clip_moves;a=[];for(i in c)0<parseInt(c[i])&&a.push(i);return h.allDocs({include_docs:!0,keys:a})}).then(function(a){a=a.rows.map(function(a){a.doc.clipQty=c[a.doc._id];a.doc.name=a.doc.move_name;return a.doc});d.resolve(a)})["catch"](function(a){d.reject(a)});return d.promise}},x={clips:function(){return this.clipsPg},favorite:function(){return this.favoritePg},news:function(){return this.newsPg},newsPg:{options:{},end:{noMore:!0},limit:k?12:7,descending:!0,init:function(){this.options={descending:this.descending,include_docs:!0,limit:this.limit,endkey:"news_",startkey:"news_\uffff"};m.resetNewsList();this.end.noMore=!0;return this.getNews()},refresh:function(){var g=a.defer(),d=m.getNewsList()[0],c=this.options.startkey,y=this.end.noMore;this.options={descending:this.descending,include_docs:!0,limit:this.limit,endkey:"news_",startkey:"news_\uffff"};var b=this,k=b.options,f=b.end;h.allDocs(k).then(function(a){if(a&&0<a.rows.length)return k.startkey=a.rows[a.rows.length-1].key,a=a.rows.map(function(a){return a.doc}),b.end.noMore=a.length<b.limit?!0:!1,a.length==b.limit&&a.splice(-1,1),a;b.end.noMore=!0;return null}).then(function(a){if(a){var g;a:{g=d._id;for(var b=0,h=a.length,l;b<h;)if(l=b+h>>>1,a[l]._id==g){g=l;break a}else a[l]._id>g?b=l+1:h=l;g=-1}-1==g?(m.resetNewsList(),m.setNewsList(a)):0!=g&&(a=a.slice(0,g),m.addNewsList(a),k.startkey=c,f.noMore=y)}return!0}).then(function(){g.resolve(!0)})["catch"](function(a){g.reject(a)});return g.promise},more:function(a){this.getNews()["catch"](function(){c.showAlert("\u65e0\u6cd5\u83b7\u53d6\u6570\u636e")})["finally"](function(){a&&a()})},hasNoMore:function(){return this.end},getNews:function(){var g=a.defer(),d=this,c=d.options;h.allDocs(c).then(function(a){a&&0<a.rows.length?(c.startkey=a.rows[a.rows.length-1].key,a=a.rows.map(function(a){return a.doc}),d.end.noMore=a.length<d.limit?!0:!1,a.length==d.limit&&a.splice(-1,1),m.setNewsList(a),g.resolve("More data fetched")):(d.end.noMore=!0,g.resolve("No more data"))})["catch"](function(a){g.reject(a)});return g.promise}},clipsPg:{options:{},end:{noMore:!0},limit:k?12:7,descending:!0,init:function(a,d){this.options={descending:this.descending,include_docs:!0,limit:this.limit,endkey:"clip_"+a+"_"+d,startkey:"clip_"+a+"_"+d+"\uffff"};m.resetClipList();this.end.noMore=!0;return this.getClips()},more:function(a){this.getClips()["catch"](function(){c.showAlert("\u65e0\u6cd5\u83b7\u53d6\u6570\u636e")})["finally"](function(){a&&a()})},hasNoMore:function(){return this.end},getClips:function(){var g=a.defer(),d=this,c=d.options;h.allDocs(c).then(function(a){if(a&&0<a.rows.length){c.startkey=a.rows[a.rows.length-1].key;var b=[];a=a.rows.map(function(a){b.push(a.doc.local);return a.doc});h.allDocs({keys:b,include_docs:!0}).then(function(c){for(i in a){var b=c.rows[i];a[i].thumb=b.doc?b.doc.thumb:"";a[i].favorite=b.doc?b.doc.favorite:!1}d.end.noMore=a.length<d.limit?!0:!1;a.length==d.limit&&a.splice(-1,1);m.setClipList(a);g.resolve("More data fetched")})["catch"](function(a){g.reject(a)})}else d.end.noMore=!0,g.resolve("No more data")})["catch"](function(a){g.reject(a)});return g.promise}},favoritePg:{options:{},end:{noMore:!0},limit:k?12:7,view:"",descending:!0,init:function(){this.view="favorite";this.options={descending:this.descending,limit:this.limit,include_docs:!0,endkey:[!0],startkey:[!0,{}]};this.end.noMore=!0;m.resetFavoriteList();return this.getFavorite()},search:function(a,c){a||(a={});this.options={descending:this.descending,limit:this.limit,include_docs:!0};a.player&&a.move?(this.view="favorite_player_move",this.options.startkey=[!0,a.player,a.move,{}],this.options.endkey=[!0,a.player,a.move]):a.player?(this.view="favorite_player",this.options.startkey=[!0,a.player,{}],this.options.endkey=[!0,a.player]):a.move?(this.view="favorite_move",this.options.startkey=[!0,a.move,{}],this.options.endkey=[!0,a.move]):(this.view="favorite",this.options.startkey=[!0,{}],this.options.endkey=[!0]);a.noResult?this.options.limit=0:m.resetFavoriteList();this.end.noMore=!0;this.more(c)},more:function(a){this.getFavorite()["catch"](function(){c.showAlert("\u65e0\u6cd5\u83b7\u53d6\u6570\u636e")})["finally"](function(){a&&a()})},hasNoMore:function(){return this.end},needLoad:function(){return!this.hasNoMore().noMore&&m.getFavoriteList().length<this.limit?!0:!1},getFavorite:function(){var c=a.defer(),d=this,b=d.options;h.query(d.view,b).then(function(a){a&&0<a.rows.length?(b.startkey=a.rows[a.rows.length-1].key,d.end.noMore=a.rows.length<d.limit?!0:!1,a.rows.length==d.limit&&a.rows.splice(-1,1),a=a.rows.map(function(a){return{_id:a.doc._id,name:a.doc.name,desc:a.doc.desc,image:a.doc.image,thumb:a.value.thumb,favorite:a.key[0],local:a.id,player:a.doc.player,move:a.doc.move,timestamp:a.value.timestamp}}),m.setFavoriteList(a),c.resolve("Favorite retrieved")):(d.end.noMore=!0,c.resolve("No more data"))})["catch"](function(a){c.reject(a)});return c.promise}}},K={syncRemote:function(a){h.replicate.from(q.remoteURL+q.dbName,{timeout:5E3}).then(function(a){return 0<a.docs_written?w(!0).then(A).then(B).then(F):!0})["catch"](function(a){(E()?navigator.connection.type!==Connection.NONE:1)?c.showAlert("\u65e0\u6cd5\u540c\u6b65\u6700\u65b0\u6570\u636e","\u8bf7\u7a0d\u5019\u518d\u8bd5\u3002",!1):c.showAlert("\u65e0\u6cd5\u540c\u6b65\u6700\u65b0\u6570\u636e","\u8bf7\u786e\u8ba4\u4e92\u8054\u7f51\u8fde\u63a5\u3002",!1)})["finally"](function(){a&&a()})},change:function(){h.changes({limit:10,since:73}).then(function(a){console.log(a)})["catch"](function(a){console.log(a)})}};b.put=function(a){return h.put(a)};b.readNews=function(a){a.read||(a.read=!0);return h.get(a._id).then(function(a){if(a.read)return!0;a.read=!0;return h.put(a)})};b.updateBoth=function(a,c,b){h.get(a).then(function(b){h.get(b.local).then(function(a){var g=new Date;a.thumb=b.image+".jpg";a.favorite=c;a.timestamp=""+g.getTime();h.put(a)})["catch"](function(){var k={_id:b.local,type:"local",favorite:c,thumb:b.image+".jpg",clip:a,player:b.player,move:b.move,timestamp:""+(new Date).getTime()};h.put(k)});c?m.addFavoriteToList(a,b.image+".jpg"):m.removeFavoriteFromList(a)});(function(b){if(b&&0<b.length)for(i in b)if(b[i]._id==a){b[i].thumb=b[i].image+".jpg";b[i].favorite=c;break}})(b)};b.updateFavorite=function(a,c,b){h.get(c).then(function(c){c.favorite=b;c.timestamp=""+(new Date).getTime();h.put(c);b?m.addFavoriteToList(a,c.thumb):m.removeFavoriteFromList(a)})["catch"](function(){h.get(a).then(function(k){k={_id:c,type:"local",favorite:b,thumb:"",clip:a,player:k.player,move:k.move,timestamp:""+(new Date).getTime()};h.put(k);m.addFavoriteToList(a,"")})})};b.updateThumb=function(a,c){var b=function(c){if(c&&0<c.length)for(i in c)if(c[i]._id==a){c[i].thumb=c[i].image+".jpg";break}};h.get(a).then(function(c){h.get(c.local).then(function(a){a.thumb=c.image+".jpg";h.put(a)})["catch"](function(){h.put({_id:c.local,type:"local",favorite:!1,thumb:c.image+".jpg",clip:a,player:c.player,move:c.move})})});b(m.getFavoriteList());b(c)};b.init=function(){var b=a.defer();D();h.get("_local/DBInstalled").then(function(a){a.postInfo&&(t.postInfo=!0);a.playInfo&&(t.playInfo=!0);l(b)})["catch"](function(a){G().then(H).then(I).then(function(){u(b)})["catch"](function(a){console.log("install err, details = "+a);q.installFail=!0;c.showAlert("\u5b89\u88c5\u9047\u5230\u5c0f\u95ee\u9898","\u8bf7\u70b9\u51fb\u91cd\u8bd5\u3002",!0);b.reject("Err in creating DB"+a)})});return b.promise};return b}]).factory("ImgCacheService",["$q","ImgCache",function(a,b){function f(a,k){b.isCached(k,function(f,l){l?b.useCachedFileWithSource(a,k):b.cacheFile(k,function(){b.useCachedFileWithSource(a,k)})})}return{cacheImg:function(a){var b=new Image;f(b,a)}}}]).factory("FileCacheService",["$q","ImgCache",function(a,b){function f(c){var k=a.defer();b.$promise.then(function(){b.cacheFile(c,function(){k.resolve("file downloaded")},function(){k.resolve("file not downloaded")})});return k.promise}return{download:function(c){var k=a.defer();b.$promise.then(function(){b.cacheFile(c,function(){b.getCachedFileURL(c,function(a,c){k.resolve(c)})},function(){k.reject("download file error")},function(a){$("#progress").val(a.loaded/a.total)})});return k.promise},cacheFiles:function(c){var b=[];angular.forEach(c,function(a){b.push(f(a.image))});return a.all(b)},cacheAvatar:function(c){var b=[];angular.forEach(c,function(a){b.push(f(a.avatar));a.star&&b.push(f(a.image))});return a.all(b)}}}]).factory("NativeService",function(){var a={},b=function(a){},f=function(a){console.log(a)};a.playAnimation=function(a){cordova.exec(b,f,"MyHybridPlugin","playClip",a)};a.playPlay=function(a){cordova.exec(b,f,"MyHybridPlugin","playPlay",a)};a.playArticle=function(a){cordova.exec(b,f,"MyHybridPlugin","showArticle",a)};a.play=function(a){cordova.exec(b,f,"MyHybridPlugin","play",a)};a.showMessage=function(a,k,n){var l="false";n&&(l="true");cordova.exec(b,f,"MyHybridPlugin","showMessage",[a,k,l])};return a}).factory("ErrorService",["$rootScope","$cordovaSplashscreen","$ionicPopup","$ionicLoading","$timeout","NativeService",function(a,b,f,c,k,n){var l={showSplashScreen:function(){b.show()},hideSplashScreen:function(){k(function(){b.hide()})},showProgress:function(){k(function(){b.addProgress()},10)},showAlert:function(a,b,c){n.showMessage(a,b?b:"\u8bf7\u7a0d\u540e\u91cd\u8bd5",c)},showDownLoader:function(){c.show({template:'<span>Downloading...</span><progress max="1" id="progress"></progress>',hideOnStateChange:!0})},showLoader:function(a){c.show({template:'<ion-spinner icon="crescent" class="spinner-assertive"></ion-spinner>',hideOnStateChange:!1,duration:a?a:0})},hideLoader:function(a){c.hide();a&&l.showAlert(a)}};return l}]);angular.module("app.controllers",[]).controller("RootCtrl",["$scope","$state","$timeout",function(a,b,f){function c(){b.go("tabsController.news")}c();a.retry=function(){c()}}]).controller("StarsCtrl",["$scope","$ionicSlideBoxDelegate","$state","ErrorService","DBService",function(a,b,f,c,k){a.stars=k.list().getStarList();b.update();b.slide(0);a.showMoves=function(a,b){k.getGaleryByPlayer(a)}}]).controller("ClipsCtrl",["$scope","$stateParams","$ionicListDelegate","DBService","NativeService",function(a,b,f,c,k){function n(b){c.updateFavorite(a.clips[b]._id,a.clips[b].local,!a.clips[b].favorite);a.clips[b].favorite=!a.clips[b].favorite}a.clips=c.list().getClipList();a.noMoreItemsAvailable=c.pagination().clips().hasNoMore();a.listCanSwipe=!0;a.playerName=b.playerName;a.moveName=b.moveName;a.playingClipIndex="";a.loadMore=function(){c.pagination().clips().more(function(){a.$broadcast("scroll.infiniteScrollComplete")})};a.play=function(b){a.playingClipIndex=b;k.playAnimation(a.clips[b].image,a.clips[b].favorite,!0)};a.updateFavorite=function(a){f.closeOptionButtons();n(a)};a.updateFavoriteFromNative=function(){n(a.playingClipIndex)};a.updateThumbFromNative=function(b){"download"!==b&&a.clips[a.playingClipIndex].thumb||c.updateThumb(a.clips[a.playingClipIndex]._id,a.clips)};a.updateBothFromNative=function(b){"download"!==b&&a.clips[a.playingClipIndex].thumb?n(a.playingClipIndex):c.updateBoth(a.clips[a.playingClipIndex]._id,!a.clips[a.playingClipIndex].favorite,a.clips)}}]).controller("FavorateCtrl",["$scope","$state","$ionicScrollDelegate","$ionicListDelegate","$ionicPopover","ErrorService","DBService","NativeService","$timeout",function(a,b,f,c,k,n,l,u,r){a.listCanSwipe=!0;a.playingClipIndex="";a.clips=[];a.search={selected_player:"",selected_move:"",by_player:"",by_move:""};a.data={players:l.list().getPlayerList(),moves:l.list().getMoveList()};k.fromTemplateUrl("templates/popover.html",{scope:a}).then(function(b){a.popover=b});a.openPopover=function(b){a.search.by_player=a.search.selected_player;a.search.by_move=a.search.selected_move;a.popover.show(b)};a.filter=function(){n.showLoader();f.scrollTop();var b={player:a.search.by_player,move:a.search.by_move};a.search.selected_player=a.search.by_player;a.search.selected_move=a.search.by_move;l.pagination().favorite().search(b,function(){n.hideLoader()});a.popover.hide()};a.loadMore=function(){l.pagination().favorite().more(function(){a.$broadcast("scroll.infiniteScrollComplete")})};a.play=function(b){a.playingClipIndex=b;u.playAnimation(a.clips[b].image,a.clips[b].favorite,!1)};a.removeFavorite=function(b){c.closeOptionButtons();l.updateFavorite(a.clips[b]._id,a.clips[b].local,!1);l.pagination().favorite().needLoad()&&a.loadMore()};a.updateThumbFromNative=function(b){"download"!==b&&a.clips[a.playingClipIndex].thumb||l.updateThumb(a.clips[a.playingClipIndex]._id,null)};var v=l.list().getFavoriteList().length;v&&n.showLoader();r(function(){a.noMoreItemsAvailable=l.pagination().favorite().hasNoMore();a.clips=l.list().getFavoriteList();v&&n.hideLoader()},300)}]).controller("PlayersCtrl",["$scope","$state","DBService","ErrorService","$timeout",function(a,b,f,c,k){a.players=f.list().getPlayerList();a.showMoves=function(a,c){b.go("tabsController.tab2Moves",{playerID:a,playerName:c})};a.myFilter=function(a){return 4<a.clip_total}}]).controller("MovesCtrl",["$scope","$stateParams","moves","DBService",function(a,b,f,c){a.moves=f;a.playerName=b.playerName;a.showClips=function(a,f){c.playClipsByMove(b.playerID,f)}}]).controller("Tab2MovesCtrl",["$scope","$stateParams","moves","DBService",function(a,b,f,c){a.moves=f;a.playerName=b.playerName;a.showClips=function(a,f){c.playClipsByMove(b.playerID,f)}}]).controller("NewsCtrl",["$scope","$state","$stateParams","DBService","ErrorService","$timeout",function(a,b,f,c,k,n){a.noMoreItemsAvailable=c.pagination().news().hasNoMore();a.news=c.list().getNewsList();k.hideSplashScreen();a.loadMore=function(){c.pagination().news().more(function(){a.$broadcast("scroll.infiniteScrollComplete")})};a.showClips=function(b){c.readNews(a.news[b])["finally"](function(){c.play().playPost(a.news[b])})};a.doRefresh=function(){c.remoteDB().syncRemote(function(){a.$broadcast("scroll.refreshComplete")})};a.$on("$ionicView.loaded",function(){n(function(){a.$broadcast("scroll.refreshStart")},300)})}]).controller("PlaysCtrl",["$scope","$state","DBService",function(a,b,f){a.cats=f.list().getPlaysList();a.myFilter=function(a){return 0<a.quantity};a.showPlays=function(a,f){b.go("tabsController.play",{catID:a,catName:f})}}]).controller("PlayCtrl",["$scope","$stateParams","DBService","plays",function(a,b,f,c){a.plays=c;a.catName=b.catName;a.playPlay=function(b){f.play().playPlay(a.plays[b].image)}}]).controller("SkillsCtrl",["$scope","$state","DBService",function(a,b,f){a.cats=f.list().getSkillsList();a.myFilter=function(a){return 0<a.count};a.showSkills=function(a,f){b.go("tabsController.skill",{catID:a,catName:f})}}]).controller("SkillCtrl",["$scope","$stateParams","DBService","plays",function(a,b,f,c){a.skills=c;a.catName=b.catName;a.play=function(b){f.play().playArticle(a.skills[b])}}]);angular.module("app.directives",[]).directive("blankDirective",[function(){}]).directive("backImg",function(){return function(a,b,f){b.css({"background-image":"url("+f.backImg+")"})}}).directive("hideTabs",["$rootScope",function(a){return{restrict:"A",link:function(b,f,c){b.$on("$ionicView.beforeEnter",function(){b.$watch(c.hideTabs,function(b){a.hideTabs=b})})}}}]);var dbString="";function startForIOS(){cordova.exec(function(a){dbString=a;angular.bootstrap(document.body,["app"])},function(a){console.log(a)},"MyHybridPlugin","dbString")}function test(){angular.element(document.getElementById("ClipsScopeID")).injector().get("DBService").list().getPlayerList()}function updateClip(a,b,f){"clip"===f?(f=angular.element(document.getElementById("ClipsScopeID")).scope(),""!==b?"favorite"===a?f.updateBothFromNative(b):f.updateThumbFromNative(b):"favorite"===a&&f.updateFavoriteFromNative()):""!==b&&(f=angular.element(document.getElementById("FavoriteScopeID")).scope(),f.updateThumbFromNative(b))}function retryInstall(){angular.element(document.getElementById("RootScopeID")).scope().retry()}angular.element(document).ready(function(){window.cordova?document.addEventListener("deviceready",function(){startForIOS()},!1):angular.bootstrap(document.body,["app"])});</script> </head><body animation="slide-left-right-ios7" class="platform-ios platform-cordova platform-webview"><ion-nav-bar class="bar-light"> <ion-nav-back-button class="button-icon icon ion-ios-arrow-back">返回</ion-nav-back-button></ion-nav-bar><ion-nav-view></ion-nav-view></body></html>